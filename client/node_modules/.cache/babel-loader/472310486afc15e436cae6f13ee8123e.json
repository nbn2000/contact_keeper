{"ast":null,"code":"var spawn = require('child_process').spawn;\n\nmodule.exports = function (rootPid, callback) {\n  var pidsOfInterest = new Set([parseInt(rootPid, 10)]);\n  var output = ''; // *nix\n\n  var ps = spawn('ps', ['-A', '-o', 'ppid,pid']);\n  ps.stdout.on('data', function (data) {\n    output += data.toString('ascii');\n  });\n  ps.on('close', function () {\n    try {\n      var res = output.split('\\n').slice(1).map(function (_) {\n        return _.trim();\n      }).reduce(function (acc, line) {\n        var pids = line.split(/\\s+/);\n        var ppid = parseInt(pids[0], 10);\n\n        if (pidsOfInterest.has(ppid)) {\n          var pid = parseInt(pids[1], 10);\n          acc.push(pid);\n          pidsOfInterest.add(pid);\n        }\n\n        return acc;\n      }, []);\n      callback(null, res);\n    } catch (e) {\n      callback(e, null);\n    }\n  });\n};","map":null,"metadata":{},"sourceType":"script"}